"1","<!-- KNITR_ASIS_OUTPUT_TOKEN -->
<!-- rnb-source-begin eyJkYXRhIjoiYGBgclxucGVkc0RmICU+JVxuICBncm91cF9ieShTYW1wbGUpICU+JVxuICBtdXRhdGUocmVsX2FiID0gQWJ1bmRhbmNlL3N1bShBYnVuZGFuY2UpKSAlPiVcbiAgdW5ncm91cCgpICU+JVxuICBncm91cF9ieShnZW51cykgJT4lXG4gIHN1bW1hcmlzZShtZWFuX3JlbF9hYiA9IG1lYW4ocmVsX2FiKSkgLT4gcGVkc19tZWFuX3JlbF9hYlxuXG5wZWRzRGYgJT4lXG4gIGdyb3VwX2J5KFNhbXBsZSkgJT4lXG4gIG11dGF0ZShyZWxfYWIgPSBBYnVuZGFuY2Uvc3VtKEFidW5kYW5jZSkpICU+JVxuICB1bmdyb3VwKCkgJT4lXG4gIGZpbHRlcihyZWxfYWIgPiAwKSAlPiVcbiAgZHBseXI6OnNlbGVjdChTYW1wbGUsZ2VudXMpICU+JVxuICBkaXN0aW5jdCgpICU+JVxuICBjb3VudChnZW51cykgJT4lXG4gIG11dGF0ZShwZXJjX3ByZXYgPSAobi8xODUpKjEwMCkgLT4gcGVkc19wZXJjX3ByZXZcblxubGVmdF9qb2luKHBlZHNfbWVhbl9yZWxfYWIscGVkc19wZXJjX3ByZXYpICU+JVxuICBmaWx0ZXIoIWlzLm5hKGdlbnVzKSkgJT4lXG4gIG11dGF0ZShtZWFuX3JlbF9hYiA9IG1lYW5fcmVsX2FiKjEwMCkgJT4lXG4gIG11dGF0ZShjb3JlX3NhdCA9IGlmX2Vsc2UocGVyY19wcmV2ID4gNzUsXCJjb3JlXCIsXCJzYXRlbGxpdGVcIikpICU+JVxuICBnZ3Bsb3QoYWVzKHggPSBwZXJjX3ByZXYsXG4gICAgICAgICAgICAgeSA9IG1lYW5fcmVsX2FiLFxuICAgICAgICAgICAgIGNvbG9yID0gY29yZV9zYXQpKSArXG4gIGdlb21fdmxpbmUoeGludGVyY2VwdCA9IDc1LFxuICAgICAgICAgICBsaW5ldHlwZSA9IFwiZGFzaGVkXCIpICtcbiAgZ2VvbV9wb2ludChhbHBoYSA9IDAuNSxcbiAgICAgICAgICAgICBzaXplID0gMykgK1xuICBzY2FsZV95X2xvZzEwKCkgK1xuICBnZW9tX2xhYmVsX3JlcGVsKGFlcyhsYWJlbCA9IGlmX2Vsc2UoY29yZV9zYXQgPT0gXCJjb3JlXCIsZ2VudXMsXCJcIiksXG4gICAgICAgICAgICAgICAgICAgICAgIGNvbG9yID0gY29yZV9zYXQpLFxuICAgICAgICAgICAgICAgICAgIG1heC5vdmVybGFwcyA9IDQwMCxcbiAgICAgICAgICAgICAgICAgICBmb3JjZV9wdWxsID0gLTAuMDEsXG4gICAgICAgICAgICAgICAgICAgbnVkZ2VfeCA9IC0xLFxuICAgICAgICAgICAgICAgICAgIG1pbi5zZWdtZW50Lmxlbmd0aCA9IDApICtcbiAgICBzY2FsZV9jb2xvcl9tYW51YWwodmFsdWVzID0gYyhcIm9yYW5nZTJcIixcImdyZXlcIikpICtcbmxhYnMoeCA9IFwiUGVyY2VudGFnZSBwcmV2YWxlbmNlXFxuKGFsbCBzYW1wbGVzKVwiLFxuICAgICB5ID0gXCJNZWFuIHJlbGF0aXZlIGFidW5kYW5jZSAoJSlcXG4oYWxsIHNhbXBsZXMpXCIpICtcbiAgdGhlbWUobGVnZW5kLnBvc2l0aW9uID0gXCJub25lXCIsXG4gICAgICAgIGF4aXMudGl0bGUueCA9IGVsZW1lbnRfdGV4dChzaXplID0gMTYpLFxuICAgICAgICBheGlzLnRpdGxlLnkgPSBlbGVtZW50X3RleHQoc2l6ZSA9IDE2KSkgLT4gcGVkc19jb3JlX3NhdF9wbG90XG5cbmdnc2F2ZShwbG90ID0gcGVkc19jb3JlX3NhdF9wbG90LFxuICAgICAgIFwicGVkaWF0cmljX2NvcmVfc2F0ZWxsaXRlX3RheGEucGRmXCIsXG4gICAgICAgaGVpZ2h0ID0gNCxcbiAgICAgICB3aWR0aCA9IDYsXG4gICAgICAgdW5pdHMgPSBjKFwiaW5cIikpXG5gYGAifQ== -->

```r
pedsDf %>%
  group_by(Sample) %>%
  mutate(rel_ab = Abundance/sum(Abundance)) %>%
  ungroup() %>%
  group_by(genus) %>%
  summarise(mean_rel_ab = mean(rel_ab)) -> peds_mean_rel_ab

pedsDf %>%
  group_by(Sample) %>%
  mutate(rel_ab = Abundance/sum(Abundance)) %>%
  ungroup() %>%
  filter(rel_ab > 0) %>%
  dplyr::select(Sample,genus) %>%
  distinct() %>%
  count(genus) %>%
  mutate(perc_prev = (n/185)*100) -> peds_perc_prev

left_join(peds_mean_rel_ab,peds_perc_prev) %>%
  filter(!is.na(genus)) %>%
  mutate(mean_rel_ab = mean_rel_ab*100) %>%
  mutate(core_sat = if_else(perc_prev > 75,\"core\",\"satellite\")) %>%
  ggplot(aes(x = perc_prev,
             y = mean_rel_ab,
             color = core_sat)) +
  geom_vline(xintercept = 75,
           linetype = \"dashed\") +
  geom_point(alpha = 0.5,
             size = 3) +
  scale_y_log10() +
  geom_label_repel(aes(label = if_else(core_sat == \"core\",genus,\"\"),
                       color = core_sat),
                   max.overlaps = 400,
                   force_pull = -0.01,
                   nudge_x = -1,
                   min.segment.length = 0) +
    scale_color_manual(values = c(\"orange2\",\"grey\")) +
labs(x = \"Percentage prevalence\n(all samples)\",
     y = \"Mean relative abundance (%)\n(all samples)\") +
  theme(legend.position = \"none\",
        axis.title.x = element_text(size = 16),
        axis.title.y = element_text(size = 16)) -> peds_core_sat_plot

ggsave(plot = peds_core_sat_plot,
       \"pediatric_core_satellite_taxa.pdf\",
       height = 4,
       width = 6,
       units = c(\"in\"))
```

<!-- rnb-source-end -->
<!-- KNITR_ASIS_OUTPUT_TOKEN -->"
"0","```r
pedsDf %>%
  group_by(Sample) %>%
  mutate(rel_ab = Abundance/sum(Abundance)) %>%
  ungroup() %>%
  group_by(genus) %>%
  summarise(mean_rel_ab = mean(rel_ab)) -> peds_mean_rel_ab

pedsDf %>%
  group_by(Sample) %>%
  mutate(rel_ab = Abundance/sum(Abundance)) %>%
  ungroup() %>%
  filter(rel_ab > 0) %>%
  dplyr::select(Sample,genus) %>%
  distinct() %>%
  count(genus) %>%
  mutate(perc_prev = (n/185)*100) -> peds_perc_prev

left_join(peds_mean_rel_ab,peds_perc_prev) %>%
  filter(!is.na(genus)) %>%
  mutate(mean_rel_ab = mean_rel_ab*100) %>%
  mutate(core_sat = if_else(perc_prev > 75,\"core\",\"satellite\")) %>%
  ggplot(aes(x = perc_prev,
             y = mean_rel_ab,
             color = core_sat)) +
  geom_vline(xintercept = 75,
           linetype = \"dashed\") +
  geom_point(alpha = 0.5,
             size = 3) +
  scale_y_log10() +
  geom_label_repel(aes(label = if_else(core_sat == \"core\",genus,\"\"),
                       color = core_sat),
                   max.overlaps = 400,
                   force_pull = -0.01,
                   nudge_x = -1,
                   min.segment.length = 0) +
    scale_color_manual(values = c(\"orange2\",\"grey\")) +
labs(x = \"Percentage prevalence\n(all samples)\",
     y = \"Mean relative abundance (%)\n(all samples)\") +
  theme(legend.position = \"none\",
        axis.title.x = element_text(size = 16),
        axis.title.y = element_text(size = 16)) -> peds_core_sat_plot

ggsave(plot = peds_core_sat_plot,
       \"pediatric_core_satellite_taxa.pdf\",
       height = 4,
       width = 6,
       units = c(\"in\"))
```"
