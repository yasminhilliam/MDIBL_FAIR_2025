"1","<!-- KNITR_ASIS_OUTPUT_TOKEN -->
<!-- rnb-source-begin eyJkYXRhIjoiYGBgclxuYWxsRGYgJT4lXG4gIGZpbHRlcighaXMubmEodmlydXMpKSAlPiVcbiAgZHBseXI6OnNlbGVjdChPVFUsQWJ1bmRhbmNlLGluZGV4LHBhdGllbnRpZCxzYW1wbGVsb2MsZGF0ZSx2aXJ1cy5iaW4sdmlydXMsdmlydXNfMix2aXNpdCxraW5nZG9tLHBoeWx1bSxjbGFzcyxvcmRlcixmYW1pbHksZ2VudXMpICU+JVxuICBncm91cF9ieShpbmRleCkgJT4lXG4gIG11dGF0ZShyZWwuYWJ1bmRhbmNlID0gQWJ1bmRhbmNlL3N1bShBYnVuZGFuY2UpLFxuICAgICAgICAgLmFmdGVyID0gT1RVKSAlPiVcbiAgbXV0YXRlKGdlbi5PVFUgPSBwYXN0ZShnZW51cyxPVFUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgc2VwID0gXCIuXCIpKSAlPiVcbiAgbXV0YXRlKGRhdGFzZXQgPSBcImFkdWx0Q0ZcIikgJT4lXG4gIHVuZ3JvdXAoKSAtPiBhZHVsdFxuXG5wZWRzRGYgJT4lXG4gIGZpbHRlcih2aXJ1cyAhPSAwKSAlPiVcbiAgZHBseXI6OnNlbGVjdChPVFUsQWJ1bmRhbmNlLHNhbXBsZUlELHBhdGllbnRfSUQsc2FtcGxlX2xvY2F0aW9uLHZpcnVzLHZpcnVzX3R5cGUsZnVfbnVtYmVyLENGX0NSU19Db250cm9sX0VDLGtpbmdkb20scGh5bHVtLGNsYXNzLG9yZGVyLGZhbWlseSxnZW51cykgJT4lXG4gIGdyb3VwX2J5KHNhbXBsZUlEKSAlPiVcbiAgbXV0YXRlKHJlbC5hYnVuZGFuY2UgPSBBYnVuZGFuY2Uvc3VtKEFidW5kYW5jZSksXG4gICAgICAgICAuYWZ0ZXIgPSBPVFUpICU+JVxuICB1bmdyb3VwKCkgJT4lXG4gIGRwbHlyOjpyZW5hbWUoaW5kZXggPSBzYW1wbGVJRCxcbiAgICAgICAgICAgICAgICBwYXRpZW50aWQgPSBwYXRpZW50X0lELFxuICAgICAgICAgICAgICAgIHNhbXBsZWxvYyA9IHNhbXBsZV9sb2NhdGlvbixcbiAgICAgICAgICAgICAgICB2aXJ1cy5iaW4gPSB2aXJ1cyxcbiAgICAgICAgICAgICAgICB2aXJ1cyA9IHZpcnVzX3R5cGUsXG4gICAgICAgICAgICAgICAgdmlzaXQgPSBmdV9udW1iZXIpICU+JVxuICBtdXRhdGUodmlydXMuYmluID0gaWZfZWxzZSh2aXJ1cy5iaW4gPT0gXCJ5XCIsMSwwKSkgJT4lXG4gIG11dGF0ZShnZW4uT1RVID0gcGFzdGUoZ2VudXMsT1RVLFxuICAgICAgICAgICAgICAgICAgICAgICAgIHNlcCA9IFwiLlwiKSkgJT4lXG4gIG11dGF0ZShkYXRhc2V0ID0gY2FzZV93aGVuKENGX0NSU19Db250cm9sX0VDID09IFwiQ0ZcIiB+IFwicGVkc0NGXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIENGX0NSU19Db250cm9sX0VDID09IFwiQ1JTXCIgfiBcInBlZHNDUlNcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVFJVRSB+IFwicGVkc0NvbnRyb2xcIikpICU+JVxuICBkcGx5cjo6c2VsZWN0KC1jKENGX0NSU19Db250cm9sX0VDKSkgJT4lXG4gIG11dGF0ZSh2aXJ1cyA9IGlmX2Vsc2UodmlydXMgPT0gXCIwXCIsXCJOb25lXCIsdmlydXMpKSAtPiBwZWRzXG5cbnVuaXF1ZShwZWRzJHZpcnVzKVxuXG5wZWRzICU+JVxuICBtdXRhdGUodmlydXNfMiA9IGNhc2Vfd2hlbih2aXJ1cyA9PSBcIkZMVS1IUlZcIiB+IFwiSHVtYW4gcmhpbm92aXJ1c1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2aXJ1cyA9PSBcIkhSVi1QSVYyXCIgfiBcIlBhcmFpbmZsdWVuemEgdmlydXMgMlwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBUUlVFIH4gXCJcIiksXG4gICAgICAgICAuYWZ0ZXIgPSB2aXJ1cykgJT4lXG4gIG11dGF0ZSh2aXJ1cyA9IGNhc2Vfd2hlbih2aXJ1cyA9PSBcIkhSVlwiIH4gXCJIdW1hbiByaGlub3ZpcnVzXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICB2aXJ1cyA9PSBcIk9DNDNcIiB+IFwiU2Vhc29uYWwgaHVtYW4gY29yb25hdmlydXMgT0M0M1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgdmlydXMgPT0gXCJSU1ZcIiB+IFwiUmVzcGlyYXRvcnkgc3luY3l0aWFsIHZpcnVzXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICB2aXJ1cyA9PSBcIkFkVlwiIH4gXCJBZGVub3ZpcnVzXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICB2aXJ1cyA9PSBcIkZMVS1IUlZcIiB+IFwiSW5mbHVlbnphIEFcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIHZpcnVzID09IFwiU0FSU0NvVjJcIiB+IFwiU0FSUy1Db1YyXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICB2aXJ1cyA9PSBcIlBJVjRcIiB+IFwiUGFyYWluZmx1ZW56YSB2aXJ1cyA0XCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICB2aXJ1cyA9PSBcIlBJVjFcIiB+IFwiUGFyYWluZmx1ZW56YSB2aXJ1cyAxXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICB2aXJ1cyA9PSBcIk1QVlwiIH4gXCJIdW1hbiBtZXRhcG5ldW1vdmlydXNcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIHZpcnVzID09IFwiSFJWLVBJVjJcIiB+IFwiSHVtYW4gcmhpbm92aXJ1c1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgVFJVRSB+IHZpcnVzKSkgLT4gcGVkc1xuXG5mYWN0b3IocGVkcyR2aXJ1cy5iaW4pIC0+IHBlZHMkdmlydXMuYmluXG5cbnBlZHMkaW5kZXggLT4gSkJBTFNcblxuZ3N1YihcIl9TaW51c1wiLFwiXCIsSkJBTFMpIC0+IEpCQUxTXG5cbmdzdWIoXCJKQkFMU1xcXFxkezJ9XFxcXFMrKFxcXFxkezZ9KSRcIixcIlxcXFwxXCIsSkJBTFMpIC0+IEpCQUxTXG5cbmdzdWIoXCJKQkFMUzAzX0NGX0ZVMTJfMjExMDhcIixcIjIxMDEwOFwiLEpCQUxTKSAtPiBKQkFMU1xuXG5hcy5EYXRlKEpCQUxTLFxuICAgICAgICBmb3JtYXQgPSBcIiV5JW0lZFwiKSAtPiBwZWRzJGRhdGUgXG5cbnJiaW5kKGFkdWx0LHBlZHMpIC0+IHZpcnVzQ29tYlxuXG5nc3ViKFwiU2ludXNcIixcInNpbnVzXCIsdmlydXNDb21iJHNhbXBsZWxvYykgLT4gdmlydXNDb21iJHNhbXBsZWxvY1xuXG5mYWN0b3IodmlydXNDb21iJGRhdGFzZXQpIC0+IHZpcnVzQ29tYiRkYXRhc2V0XG5gYGAifQ== -->

```r
allDf %>%
  filter(!is.na(virus)) %>%
  dplyr::select(OTU,Abundance,index,patientid,sampleloc,date,virus.bin,virus,virus_2,visit,kingdom,phylum,class,order,family,genus) %>%
  group_by(index) %>%
  mutate(rel.abundance = Abundance/sum(Abundance),
         .after = OTU) %>%
  mutate(gen.OTU = paste(genus,OTU,
                         sep = \".\")) %>%
  mutate(dataset = \"adultCF\") %>%
  ungroup() -> adult

pedsDf %>%
  filter(virus != 0) %>%
  dplyr::select(OTU,Abundance,sampleID,patient_ID,sample_location,virus,virus_type,fu_number,CF_CRS_Control_EC,kingdom,phylum,class,order,family,genus) %>%
  group_by(sampleID) %>%
  mutate(rel.abundance = Abundance/sum(Abundance),
         .after = OTU) %>%
  ungroup() %>%
  dplyr::rename(index = sampleID,
                patientid = patient_ID,
                sampleloc = sample_location,
                virus.bin = virus,
                virus = virus_type,
                visit = fu_number) %>%
  mutate(virus.bin = if_else(virus.bin == \"y\",1,0)) %>%
  mutate(gen.OTU = paste(genus,OTU,
                         sep = \".\")) %>%
  mutate(dataset = case_when(CF_CRS_Control_EC == \"CF\" ~ \"pedsCF\",
                             CF_CRS_Control_EC == \"CRS\" ~ \"pedsCRS\",
                             TRUE ~ \"pedsControl\")) %>%
  dplyr::select(-c(CF_CRS_Control_EC)) %>%
  mutate(virus = if_else(virus == \"0\",\"None\",virus)) -> peds

unique(peds$virus)

peds %>%
  mutate(virus_2 = case_when(virus == \"FLU-HRV\" ~ \"Human rhinovirus\",
                             virus == \"HRV-PIV2\" ~ \"Parainfluenza virus 2\",
                             TRUE ~ \"\"),
         .after = virus) %>%
  mutate(virus = case_when(virus == \"HRV\" ~ \"Human rhinovirus\",
                           virus == \"OC43\" ~ \"Seasonal human coronavirus OC43\",
                           virus == \"RSV\" ~ \"Respiratory syncytial virus\",
                           virus == \"AdV\" ~ \"Adenovirus\",
                           virus == \"FLU-HRV\" ~ \"Influenza A\",
                           virus == \"SARSCoV2\" ~ \"SARS-CoV2\",
                           virus == \"PIV4\" ~ \"Parainfluenza virus 4\",
                           virus == \"PIV1\" ~ \"Parainfluenza virus 1\",
                           virus == \"MPV\" ~ \"Human metapneumovirus\",
                           virus == \"HRV-PIV2\" ~ \"Human rhinovirus\",
                           TRUE ~ virus)) -> peds

factor(peds$virus.bin) -> peds$virus.bin

peds$index -> JBALS

gsub(\"_Sinus\",\"\",JBALS) -> JBALS

gsub(\"JBALS\\d{2}\\S+(\\d{6})$\",\"\\1\",JBALS) -> JBALS

gsub(\"JBALS03_CF_FU12_21108\",\"210108\",JBALS) -> JBALS

as.Date(JBALS,
        format = \"%y%m%d\") -> peds$date 

rbind(adult,peds) -> virusComb

gsub(\"Sinus\",\"sinus\",virusComb$sampleloc) -> virusComb$sampleloc

factor(virusComb$dataset) -> virusComb$dataset
```

<!-- rnb-source-end -->
<!-- KNITR_ASIS_OUTPUT_TOKEN -->"
"0","```r
allDf %>%
  filter(!is.na(virus)) %>%
  dplyr::select(OTU,Abundance,index,patientid,sampleloc,date,virus.bin,virus,virus_2,visit,kingdom,phylum,class,order,family,genus) %>%
  group_by(index) %>%
  mutate(rel.abundance = Abundance/sum(Abundance),
         .after = OTU) %>%
  mutate(gen.OTU = paste(genus,OTU,
                         sep = \".\")) %>%
  mutate(dataset = \"adultCF\") %>%
  ungroup() -> adult

pedsDf %>%
  filter(virus != 0) %>%
  dplyr::select(OTU,Abundance,sampleID,patient_ID,sample_location,virus,virus_type,fu_number,CF_CRS_Control_EC,kingdom,phylum,class,order,family,genus) %>%
  group_by(sampleID) %>%
  mutate(rel.abundance = Abundance/sum(Abundance),
         .after = OTU) %>%
  ungroup() %>%
  dplyr::rename(index = sampleID,
                patientid = patient_ID,
                sampleloc = sample_location,
                virus.bin = virus,
                virus = virus_type,
                visit = fu_number) %>%
  mutate(virus.bin = if_else(virus.bin == \"y\",1,0)) %>%
  mutate(gen.OTU = paste(genus,OTU,
                         sep = \".\")) %>%
  mutate(dataset = case_when(CF_CRS_Control_EC == \"CF\" ~ \"pedsCF\",
                             CF_CRS_Control_EC == \"CRS\" ~ \"pedsCRS\",
                             TRUE ~ \"pedsControl\")) %>%
  dplyr::select(-c(CF_CRS_Control_EC)) %>%
  mutate(virus = if_else(virus == \"0\",\"None\",virus)) -> peds

unique(peds$virus)

peds %>%
  mutate(virus_2 = case_when(virus == \"FLU-HRV\" ~ \"Human rhinovirus\",
                             virus == \"HRV-PIV2\" ~ \"Parainfluenza virus 2\",
                             TRUE ~ \"\"),
         .after = virus) %>%
  mutate(virus = case_when(virus == \"HRV\" ~ \"Human rhinovirus\",
                           virus == \"OC43\" ~ \"Seasonal human coronavirus OC43\",
                           virus == \"RSV\" ~ \"Respiratory syncytial virus\",
                           virus == \"AdV\" ~ \"Adenovirus\",
                           virus == \"FLU-HRV\" ~ \"Influenza A\",
                           virus == \"SARSCoV2\" ~ \"SARS-CoV2\",
                           virus == \"PIV4\" ~ \"Parainfluenza virus 4\",
                           virus == \"PIV1\" ~ \"Parainfluenza virus 1\",
                           virus == \"MPV\" ~ \"Human metapneumovirus\",
                           virus == \"HRV-PIV2\" ~ \"Human rhinovirus\",
                           TRUE ~ virus)) -> peds

factor(peds$virus.bin) -> peds$virus.bin

peds$index -> JBALS

gsub(\"_Sinus\",\"\",JBALS) -> JBALS

gsub(\"JBALS\\d{2}\\S+(\\d{6})$\",\"\\1\",JBALS) -> JBALS

gsub(\"JBALS03_CF_FU12_21108\",\"210108\",JBALS) -> JBALS

as.Date(JBALS,
        format = \"%y%m%d\") -> peds$date 

rbind(adult,peds) -> virusComb

gsub(\"Sinus\",\"sinus\",virusComb$sampleloc) -> virusComb$sampleloc

factor(virusComb$dataset) -> virusComb$dataset
```"
