"1","<!-- KNITR_ASIS_OUTPUT_TOKEN -->
<!-- rnb-source-begin eyJkYXRhIjoiYGBgclxubGVmdF9qb2luKGFsbERmLGFkdWx0ZGF5cykgJT4lXG4gIGZpbHRlcihpbmRleCAlaW4lIHNpbnNwdSkgJT4lXG4gIGZpbHRlcihwYXRpZW50aWQgJWluJSBzcHV0dW1wdCkgJT4lXG4gIGZpbHRlcihzYW1wbGVsb2MgPT0gXCJzcHV0dW1cIikgJT4lXG4gIGZpbHRlcighaXMubmEoYmVmb3JlLmFmdGVyKSkgJT4lXG4gIGRwbHlyOjpzZWxlY3QoT1RVLEFidW5kYW5jZSxpbmRleCkgJT4lXG4gIGRpc3RpbmN0KCkgJT4lXG4gIHBpdm90X3dpZGVyKG5hbWVzX2Zyb20gPSBPVFUsXG4gICAgICAgICAgICAgIHZhbHVlc19mcm9tID0gQWJ1bmRhbmNlKSAlPiVcbiAgY29sdW1uX3RvX3Jvd25hbWVzKFwiaW5kZXhcIikgLT4gc3B1dHVtU3Vic2V0XG5cbmxlZnRfam9pbihhbGxEZixhZHVsdGRheXMpICU+JVxuICBmaWx0ZXIoaW5kZXggJWluJSBzaW5zcHUpICU+JVxuICBmaWx0ZXIocGF0aWVudGlkICVpbiUgc3B1dHVtcHQpICU+JVxuICBmaWx0ZXIoIWlzLm5hKGJlZm9yZS5hZnRlcikpICU+JVxuICBkcGx5cjo6c2VsZWN0KGluZGV4LHBhdGllbnRpZCxzYW1wbGVsb2MsdmlydXMuYmluLGJlZm9yZS5hZnRlcikgLT4gc3B1dHVtU3Vic2V0TWV0YVxuXG5zcHV0dW1TdWJzZXQgJT4lXG4gIGF2Z2Rpc3Qoc2FtcGxlID0gMTA0NSxcbiAgICAgICAgICBkbWV0aG9kID0gXCJob3JuXCIpIC0+IHNwdXR1bVN1YnNldERpc3Rcblxuc3B1dHVtU3Vic2V0RGlzdCAlPiVcbiAgaGNsdXN0KG1ldGhvZCA9IFwid2FyZC5EMlwiKSAtPiBzcHV0dW1TdWJzZXRDbHVzdFxuXG53Y21kc2NhbGUoc3B1dHVtU3Vic2V0RGlzdCxcbiAgICAgICAgICBlaWcgPSBUUlVFKSAtPiBzcHV0dW1TdWJzZXRQQ29BXG5cbm9yZGlwbG90KHNwdXR1bVN1YnNldFBDb0EpXG5cbihzcHV0dW1TdWJzZXRQQ29BJGVpZ1sxXSAvIHN1bShzcHV0dW1TdWJzZXRQQ29BJGVpZykpKjEwMCAjIDY2LjUlXG5cbihzcHV0dW1TdWJzZXRQQ29BJGVpZ1syXSAvIHN1bShzcHV0dW1TdWJzZXRQQ29BJGVpZykpKjEwMCAjIDMwLjklXG5cbnNwdXR1bVN1YnNldFBDb0EgJT4lXG4gIHNjb3JlcygpICU+JVxuICBhc190aWJibGUocm93bmFtZXMgPSBcImluZGV4XCIpICU+JVxuICBkcGx5cjo6c2VsZWN0KGluZGV4LERpbTEsRGltMikgLT4gc3B1dHVtU3Vic2V0SG9yblBDb0FcblxuaW5uZXJfam9pbihzcHV0dW1TdWJzZXRNZXRhLHNwdXR1bVN1YnNldEhvcm5QQ29BKSAtPiBzcHV0dW1TdWJzZXRQQ29BTWV0YVxuXG5kaXN0aW5jdChzcHV0dW1TdWJzZXRQQ29BTWV0YSkgLT4gc3B1dHVtU3Vic2V0UENvQU1ldGFcblxuc3B1dHVtU3Vic2V0UENvQU1ldGEgJT4lXG4gIG11dGF0ZShncm91cCA9IHBhc3RlKHBhdGllbnRpZCxiZWZvcmUuYWZ0ZXIsXG4gICAgICAgICAgICAgICAgICAgICAgIHNlcCA9IFwiX1wiKSkgLT4gc3B1dHVtU3Vic2V0UENvQU1ldGFcblxuYmV0YWRpc3BlcihzcHV0dW1TdWJzZXREaXN0LFxuICAgICAgICAgICBncm91cCA9IGFzLmZhY3RvcihzcHV0dW1TdWJzZXRQQ29BTWV0YSRncm91cCksXG4gICAgICAgICAgIHR5cGUgPSBcImNlbnRyb2lkXCIpIC0+IHNwdXR1bVN1YnNldERGQ1xuXG5zcHV0dW1TdWJzZXRERkMgPC0gYXMuZGF0YS5mcmFtZShzcHV0dW1TdWJzZXRERkMkZGlzdGFuY2VzKVxuXG5yb3duYW1lcyhzcHV0dW1TdWJzZXRERkMpIC0+IHNwdXR1bVN1YnNldERGQyRpbmRleFxuXG5zcHV0dW1TdWJzZXRERkMgJT4lXG4gIGRwbHlyOjpyZW5hbWUoY2VudHJvaWQuZGlzdGFuY2UgPSAxKSAtPiBzcHV0dW1TdWJzZXRERkNcblxubGVmdF9qb2luKHNwdXR1bVN1YnNldFBDb0FNZXRhLHNwdXR1bVN1YnNldERGQykgLT4gc3B1dHVtU3Vic2V0REZDXG5cbmJldGFkaXN0YW5jZXMoc3B1dHVtU3Vic2V0REZDKSAtPiBzcHV0dW1hbGxjb21wXG5cbnNwdXR1bWFsbGNvbXAgJT4lXG4gIG11dGF0ZShpbmRleCA9IHJvd25hbWVzKHNwdXR1bWFsbGNvbXApLFxuICAgICAgICAgLmJlZm9yZSA9IGdyb3VwKSAlPiVcbiAgc2VwYXJhdGVfd2lkZXJfZGVsaW0oY29scyA9IGdyb3VwLFxuICAgICAgICAgICAgICAgICAgICAgICBcIl9cIixcbiAgICAgICAgICAgICAgICAgICAgICAgbmFtZXMgPSBjKFwicGF0aWVudGlkXCIsXCJncm91cFwiKSkgJT4lXG4gIHBpdm90X2xvbmdlcihjb2xzID0gYyg0OjIxKSxcbiAgICAgICAgICAgICAgIG5hbWVzX3RvID0gXCJjb21wXCIsXG4gICAgICAgICAgICAgICB2YWx1ZXNfdG8gPSBcImRpc3RhbmNlXCIpICU+JVxuICBzZXBhcmF0ZV93aWRlcl9kZWxpbShjb2xzID0gY29tcCxcbiAgICAgICAgICAgICAgICAgICAgICAgXCJfXCIsXG4gICAgICAgICAgICAgICAgICAgICAgIG5hbWVzID0gYyhcImNvbXBfcGF0aWVudGlkXCIsXCJjb21wX2dyb3VwXCIpKSAlPiVcbiAgZmlsdGVyKHBhdGllbnRpZCA9PSBjb21wX3BhdGllbnRpZCkgLT4gc3B1dHVtYWxsY29tcFxuXG5mYWN0b3Ioc3B1dHVtYWxsY29tcCRjb21wX2dyb3VwLFxuICAgICAgIGxldmVscyA9IGMoXCJiZWZvcmVcIixcImR1cmluZ1wiLFwiYWZ0ZXJcIikpIC0+IHNwdXR1bWFsbGNvbXAkY29tcF9ncm91cFxuXG5mYWN0b3Ioc3B1dHVtYWxsY29tcCRncm91cCxcbiAgICAgICBsZXZlbHMgPSBjKFwiYmVmb3JlXCIsXCJkdXJpbmdcIixcImFmdGVyXCIpKSAtPiBzcHV0dW1hbGxjb21wJGdyb3VwXG5cbnNwdXR1bWFsbGNvbXAgJT4lXG4gIGdyb3VwX2J5KGdyb3VwLGNvbXBfZ3JvdXApICU+JVxuICBpZGVudGlmeV9vdXRsaWVycyhkaXN0YW5jZSkgJT4lXG4gIC4kaW5kZXggLT4gc3B1dHVtZGlzdGFuY2VvdXRsaWVyc1xuXG5zcHV0dW1hbGxjb21wICU+JVxuICBtdXRhdGUoc2VsZl90ZXN0ID0gaWZfZWxzZShncm91cCA9PSBjb21wX2dyb3VwLFwic2VsZlwiLFwibm9uLXNlbGZcIikpICU+JVxuICBnZ3Bsb3QoYWVzKHggPSBncm91cCxcbiAgICAgICAgICAgICB5ID0gZGlzdGFuY2UsXG4gICAgICAgICAgICAgY29sb3IgPSBjb21wX2dyb3VwKSkgK1xuICBnZW9tX2JveHBsb3Qob3V0bGllcnMgPSBGQUxTRSkgK1xuICBnZW9tX2ppdHRlcihhZXMoc2hhcGUgPSBzZWxmX3Rlc3QpLFxuICAgICAgICAgICAgICBzaXplID0gNSxcbiAgICAgICAgICAgICAgYWxwaGEgPSAwLjUsXG4gICAgICAgICAgICAgIHdpZHRoID0gMC4xKSArXG4gIHNjYWxlX2NvbG9yX21hbnVhbCh2YWx1ZXMgPSBjKFwiIzIwYTM5ZVwiLFwiZ29sZFwiLFwiI2VmNWI1YlwiKSxcbiAgICAgICAgICAgICAgICAgICAgIGd1aWRlID0gXCJub25lXCIpICtcbiAgc2NhbGVfc2hhcGVfbWFudWFsKHZhbHVlcyA9IGMoMTYsMSksXG4gICAgICAgICAgICAgICAgICAgICBndWlkZSA9IFwibm9uZVwiKSArXG4gIHNjYWxlX3hfZGlzY3JldGUobmFtZSA9IFwiU2FtcGxlIHZpcmFsIHN0YXR1c1wiLFxuICAgICAgICAgICAgICAgICAgIGxhYmVscyA9IGMoXCJQcmlvclwiLFwiQWN0aXZlXCIsXCJQb3N0XCIpKSArXG4gIGxhYnMoeSA9IFwiRGlzdGFuY2UgdG8gY2VudHJvaWRcIixcbiAgICAgICBzdWJ0aXRsZSA9IFwiQ2VudHJvaWQgY29tcGFyYXRvclwiKSArXG4gIGZhY2V0X3dyYXAofmNvbXBfZ3JvdXAsXG4gICAgICAgICAgICAgbGFiZWxsZXIgPSBhc19sYWJlbGxlcihjKFwiYmVmb3JlXCIgPSBcIlByaW9yXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiZHVyaW5nXCIgPSBcIkFjdGl2ZVwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImFmdGVyXCIgPSBcIlBvc3RcIikpKSArXG4gIHRoZW1lKHN0cmlwLmJhY2tncm91bmQgPSBlbGVtZW50X2JsYW5rKCksXG4gICAgICAgIHBsb3Quc3VidGl0bGUgPSBlbGVtZW50X3RleHQoc2l6ZSA9IDE4LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhqdXN0ID0gMC41KSkgLT4gc3B1dHVtYWxsY29tcHBsb3RcblxuZ2dzYXZlKHBsb3QgPSBzcHV0dW1hbGxjb21wcGxvdCxcbiAgICAgICAgICAgIFwiYWR1bHRfc3B1dHVtX3ZpcmFsX2NlbnRyb2lkX2Rpc3RhbmNlX2JveHBsb3QucGRmXCIsXG4gICAgICAgICAgICBoZWlnaHQgPSA4LFxuICAgICAgICAgICAgd2lkdGggPSAxMixcbiAgICAgICAgICAgIHVuaXRzID0gYyhcImluXCIpKVxuYGBgIn0= -->

```r
left_join(allDf,adultdays) %>%
  filter(index %in% sinspu) %>%
  filter(patientid %in% sputumpt) %>%
  filter(sampleloc == \"sputum\") %>%
  filter(!is.na(before.after)) %>%
  dplyr::select(OTU,Abundance,index) %>%
  distinct() %>%
  pivot_wider(names_from = OTU,
              values_from = Abundance) %>%
  column_to_rownames(\"index\") -> sputumSubset

left_join(allDf,adultdays) %>%
  filter(index %in% sinspu) %>%
  filter(patientid %in% sputumpt) %>%
  filter(!is.na(before.after)) %>%
  dplyr::select(index,patientid,sampleloc,virus.bin,before.after) -> sputumSubsetMeta

sputumSubset %>%
  avgdist(sample = 1045,
          dmethod = \"horn\") -> sputumSubsetDist

sputumSubsetDist %>%
  hclust(method = \"ward.D2\") -> sputumSubsetClust

wcmdscale(sputumSubsetDist,
          eig = TRUE) -> sputumSubsetPCoA

ordiplot(sputumSubsetPCoA)

(sputumSubsetPCoA$eig[1] / sum(sputumSubsetPCoA$eig))*100 # 66.5%

(sputumSubsetPCoA$eig[2] / sum(sputumSubsetPCoA$eig))*100 # 30.9%

sputumSubsetPCoA %>%
  scores() %>%
  as_tibble(rownames = \"index\") %>%
  dplyr::select(index,Dim1,Dim2) -> sputumSubsetHornPCoA

inner_join(sputumSubsetMeta,sputumSubsetHornPCoA) -> sputumSubsetPCoAMeta

distinct(sputumSubsetPCoAMeta) -> sputumSubsetPCoAMeta

sputumSubsetPCoAMeta %>%
  mutate(group = paste(patientid,before.after,
                       sep = \"_\")) -> sputumSubsetPCoAMeta

betadisper(sputumSubsetDist,
           group = as.factor(sputumSubsetPCoAMeta$group),
           type = \"centroid\") -> sputumSubsetDFC

sputumSubsetDFC <- as.data.frame(sputumSubsetDFC$distances)

rownames(sputumSubsetDFC) -> sputumSubsetDFC$index

sputumSubsetDFC %>%
  dplyr::rename(centroid.distance = 1) -> sputumSubsetDFC

left_join(sputumSubsetPCoAMeta,sputumSubsetDFC) -> sputumSubsetDFC

betadistances(sputumSubsetDFC) -> sputumallcomp

sputumallcomp %>%
  mutate(index = rownames(sputumallcomp),
         .before = group) %>%
  separate_wider_delim(cols = group,
                       \"_\",
                       names = c(\"patientid\",\"group\")) %>%
  pivot_longer(cols = c(4:21),
               names_to = \"comp\",
               values_to = \"distance\") %>%
  separate_wider_delim(cols = comp,
                       \"_\",
                       names = c(\"comp_patientid\",\"comp_group\")) %>%
  filter(patientid == comp_patientid) -> sputumallcomp

factor(sputumallcomp$comp_group,
       levels = c(\"before\",\"during\",\"after\")) -> sputumallcomp$comp_group

factor(sputumallcomp$group,
       levels = c(\"before\",\"during\",\"after\")) -> sputumallcomp$group

sputumallcomp %>%
  group_by(group,comp_group) %>%
  identify_outliers(distance) %>%
  .$index -> sputumdistanceoutliers

sputumallcomp %>%
  mutate(self_test = if_else(group == comp_group,\"self\",\"non-self\")) %>%
  ggplot(aes(x = group,
             y = distance,
             color = comp_group)) +
  geom_boxplot(outliers = FALSE) +
  geom_jitter(aes(shape = self_test),
              size = 5,
              alpha = 0.5,
              width = 0.1) +
  scale_color_manual(values = c(\"#20a39e\",\"gold\",\"#ef5b5b\"),
                     guide = \"none\") +
  scale_shape_manual(values = c(16,1),
                     guide = \"none\") +
  scale_x_discrete(name = \"Sample viral status\",
                   labels = c(\"Prior\",\"Active\",\"Post\")) +
  labs(y = \"Distance to centroid\",
       subtitle = \"Centroid comparator\") +
  facet_wrap(~comp_group,
             labeller = as_labeller(c(\"before\" = \"Prior\",
                                      \"during\" = \"Active\",
                                      \"after\" = \"Post\"))) +
  theme(strip.background = element_blank(),
        plot.subtitle = element_text(size = 18,
                                     hjust = 0.5)) -> sputumallcompplot

ggsave(plot = sputumallcompplot,
            \"adult_sputum_viral_centroid_distance_boxplot.pdf\",
            height = 8,
            width = 12,
            units = c(\"in\"))
```

<!-- rnb-source-end -->
<!-- KNITR_ASIS_OUTPUT_TOKEN -->"
"0","```r
left_join(allDf,adultdays) %>%
  filter(index %in% sinspu) %>%
  filter(patientid %in% sputumpt) %>%
  filter(sampleloc == \"sputum\") %>%
  filter(!is.na(before.after)) %>%
  dplyr::select(OTU,Abundance,index) %>%
  distinct() %>%
  pivot_wider(names_from = OTU,
              values_from = Abundance) %>%
  column_to_rownames(\"index\") -> sputumSubset

left_join(allDf,adultdays) %>%
  filter(index %in% sinspu) %>%
  filter(patientid %in% sputumpt) %>%
  filter(!is.na(before.after)) %>%
  dplyr::select(index,patientid,sampleloc,virus.bin,before.after) -> sputumSubsetMeta

sputumSubset %>%
  avgdist(sample = 1045,
          dmethod = \"horn\") -> sputumSubsetDist

sputumSubsetDist %>%
  hclust(method = \"ward.D2\") -> sputumSubsetClust

wcmdscale(sputumSubsetDist,
          eig = TRUE) -> sputumSubsetPCoA

ordiplot(sputumSubsetPCoA)

(sputumSubsetPCoA$eig[1] / sum(sputumSubsetPCoA$eig))*100 # 66.5%

(sputumSubsetPCoA$eig[2] / sum(sputumSubsetPCoA$eig))*100 # 30.9%

sputumSubsetPCoA %>%
  scores() %>%
  as_tibble(rownames = \"index\") %>%
  dplyr::select(index,Dim1,Dim2) -> sputumSubsetHornPCoA

inner_join(sputumSubsetMeta,sputumSubsetHornPCoA) -> sputumSubsetPCoAMeta

distinct(sputumSubsetPCoAMeta) -> sputumSubsetPCoAMeta

sputumSubsetPCoAMeta %>%
  mutate(group = paste(patientid,before.after,
                       sep = \"_\")) -> sputumSubsetPCoAMeta

betadisper(sputumSubsetDist,
           group = as.factor(sputumSubsetPCoAMeta$group),
           type = \"centroid\") -> sputumSubsetDFC

sputumSubsetDFC <- as.data.frame(sputumSubsetDFC$distances)

rownames(sputumSubsetDFC) -> sputumSubsetDFC$index

sputumSubsetDFC %>%
  dplyr::rename(centroid.distance = 1) -> sputumSubsetDFC

left_join(sputumSubsetPCoAMeta,sputumSubsetDFC) -> sputumSubsetDFC

betadistances(sputumSubsetDFC) -> sputumallcomp

sputumallcomp %>%
  mutate(index = rownames(sputumallcomp),
         .before = group) %>%
  separate_wider_delim(cols = group,
                       \"_\",
                       names = c(\"patientid\",\"group\")) %>%
  pivot_longer(cols = c(4:21),
               names_to = \"comp\",
               values_to = \"distance\") %>%
  separate_wider_delim(cols = comp,
                       \"_\",
                       names = c(\"comp_patientid\",\"comp_group\")) %>%
  filter(patientid == comp_patientid) -> sputumallcomp

factor(sputumallcomp$comp_group,
       levels = c(\"before\",\"during\",\"after\")) -> sputumallcomp$comp_group

factor(sputumallcomp$group,
       levels = c(\"before\",\"during\",\"after\")) -> sputumallcomp$group

sputumallcomp %>%
  group_by(group,comp_group) %>%
  identify_outliers(distance) %>%
  .$index -> sputumdistanceoutliers

sputumallcomp %>%
  mutate(self_test = if_else(group == comp_group,\"self\",\"non-self\")) %>%
  ggplot(aes(x = group,
             y = distance,
             color = comp_group)) +
  geom_boxplot(outliers = FALSE) +
  geom_jitter(aes(shape = self_test),
              size = 5,
              alpha = 0.5,
              width = 0.1) +
  scale_color_manual(values = c(\"#20a39e\",\"gold\",\"#ef5b5b\"),
                     guide = \"none\") +
  scale_shape_manual(values = c(16,1),
                     guide = \"none\") +
  scale_x_discrete(name = \"Sample viral status\",
                   labels = c(\"Prior\",\"Active\",\"Post\")) +
  labs(y = \"Distance to centroid\",
       subtitle = \"Centroid comparator\") +
  facet_wrap(~comp_group,
             labeller = as_labeller(c(\"before\" = \"Prior\",
                                      \"during\" = \"Active\",
                                      \"after\" = \"Post\"))) +
  theme(strip.background = element_blank(),
        plot.subtitle = element_text(size = 18,
                                     hjust = 0.5)) -> sputumallcompplot

ggsave(plot = sputumallcompplot,
            \"adult_sputum_viral_centroid_distance_boxplot.pdf\",
            height = 8,
            width = 12,
            units = c(\"in\"))
```"
