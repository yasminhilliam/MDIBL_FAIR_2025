"1","<!-- KNITR_ASIS_OUTPUT_TOKEN -->
<!-- rnb-source-begin eyJkYXRhIjoiYGBgclxucGxvdF90YXhhIDwtIGZ1bmN0aW9uKGRmLHB0aWQpe1xuICBwZGYocGFzdGUoXG4gICAgcGFzdGUoXG4gICAgICBcImFkdWx0X3ByZV9wb3N0X3Bsb3RzXCIscHRpZCxcbiAgICAgIHNlcCA9IFwiL1wiKSxcbiAgICBcIi5wZGZcIixcbiAgICBzZXAgPSBcIlwiKSxcbiAgcGFwZXIgPSBcImE0XCIpXG4gIFxucHJpbnQoZGYgJT4lXG4gICAgZmlsdGVyKGluZGV4ICVpbiUgc2luc3B1KSAlPiVcbiAgICBmaWx0ZXIocGF0aWVudGlkID09IHB0aWQpICU+JVxuICAgIG11dGF0ZShnZW51cyA9IGlmX2Vsc2UoZ2VudXMgJWluJSBjKFwiQWNocm9tb2JhY3RlclwiLFwiQ29yeW5lYmFjdGVyaXVtXCIsXCJQc2V1ZG9tb25hc1wiLFwiUm90aGlhXCIsXCJTdGFwaHlsb2NvY2N1c1wiLFwiU3RyZXB0b2NvY2N1c1wiKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICBwYXN0ZShcIipcIixnZW51cyxcIipcIixzZXAgPSBcIlwiKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICBcIk90aGVyXCIpKSAlPiVcbiAgICBnZ3Bsb3QoYWVzKHggPSBkYXRlLFxuICAgICAgICAgICAgICAgeSA9IHJlbF9hYixcbiAgICAgICAgICAgICAgIGZpbGwgPSBnZW51cykpICtcbiAgICBnZW9tX2NvbChwb3NpdGlvbiA9IFwic3RhY2tcIikgK1xuICAgIGdlb21fc2VnbWVudChhZXMoeCA9IGRhdGUsXG4gICAgICAgICAgICAgICAgICAgICB5ID0gMTAxLFxuICAgICAgICAgICAgICAgICAgIHllbmQgPSAxMTAsXG4gICAgICAgICAgICAgICAgICAgICBjb2xvciA9IHZpcnVzLmJpbiksXG4gICAgICAgICAgICAgICAgIGxpbmV3aWR0aCA9IDYpICtcbiAgICBzY2FsZV9jb2xvcl9tYW51YWwodmFsdWVzID0gdmlyY29scykgK1xuICAgIHNjYWxlX2ZpbGxfbWFudWFsKHZhbHVlcyA9IGdlbmNvbHMpICtcbiAgICBmYWNldF9ncmlkKHJvd3MgPSB2YXJzKHNhbXBsZWxvYykpICtcbiAgICB0aGVtZSgpKVxuXG5kZXYub2ZmKClcbn1cblxuYWxsRGYgJT4lXG4gIGRwbHlyOjpzZWxlY3QoaW5kZXgscGF0aWVudGlkKSAlPiVcbiAgZmlsdGVyKGluZGV4ICVpbiUgc2luc3B1KSAlPiVcbiAgZGlzdGluY3QoKSAlPiVcbiAgLiRwYXRpZW50aWQgLT4gc2luc3B1UHRJRFxuXG5mb3IoeCBpbiBzaW5zcHVQdElEKXtcbiAgcGxvdF90YXhhKGFsbERmLHgpXG59XG5cbmFsbERmICU+JVxuICBmaWx0ZXIocGF0aWVudGlkID09IFwiR0VTQ0YwMlwiKSAlPiVcbiAgbXV0YXRlKGdlbnVzID0gaWZfZWxzZShnZW51cyAlaW4lIGMoXCJBY2hyb21vYmFjdGVyXCIsXCJDb3J5bmViYWN0ZXJpdW1cIixcIlBzZXVkb21vbmFzXCIsXCJSb3RoaWFcIixcIlN0YXBoeWxvY29jY3VzXCIsXCJTdHJlcHRvY29jY3VzXCIpLFxuICAgICAgICAgICAgICAgICAgICAgICAgIHBhc3RlKFwiKlwiLGdlbnVzLFwiKlwiLHNlcCA9IFwiXCIpLFxuICAgICAgICAgICAgICAgICAgICAgICAgIFwiT3RoZXJcIikpICU+JVxuZ2dwbG90KGFlcyh4ID0gZGF0ZSxcbiAgICAgICAgICAgICAgIHkgPSByZWxfYWIsXG4gICAgICAgICAgICAgICBmaWxsID0gZ2VudXMpKSArXG4gICAgZ2VvbV9jb2wocG9zaXRpb24gPSBcInN0YWNrXCIpICtcbiAgICBnZW9tX3NlZ21lbnQoYWVzKHggPSBkYXRlLFxuICAgICAgICAgICAgICAgICAgICAgeSA9IDEwMSxcbiAgICAgICAgICAgICAgICAgICB5ZW5kID0gMTEwLFxuICAgICAgICAgICAgICAgICAgICAgY29sb3IgPSB2aXJ1cy5iaW4pLFxuICAgICAgICAgICAgICAgICBsaW5ld2lkdGggPSA2KSArXG4gICAgc2NhbGVfY29sb3JfbWFudWFsKHZhbHVlcyA9IHZpcmNvbHMpICtcbiAgICBzY2FsZV9maWxsX21hbnVhbCh2YWx1ZXMgPSBnZW5jb2xzKSArXG4gICAgZmFjZXRfZ3JpZChyb3dzID0gdmFycyhzYW1wbGVsb2MpKSArXG4gICAgdGhlbWUoKVxuYGBgIn0= -->

```r
plot_taxa <- function(df,ptid){
  pdf(paste(
    paste(
      \"adult_pre_post_plots\",ptid,
      sep = \"/\"),
    \".pdf\",
    sep = \"\"),
  paper = \"a4\")
  
print(df %>%
    filter(index %in% sinspu) %>%
    filter(patientid == ptid) %>%
    mutate(genus = if_else(genus %in% c(\"Achromobacter\",\"Corynebacterium\",\"Pseudomonas\",\"Rothia\",\"Staphylococcus\",\"Streptococcus\"),
                         paste(\"*\",genus,\"*\",sep = \"\"),
                         \"Other\")) %>%
    ggplot(aes(x = date,
               y = rel_ab,
               fill = genus)) +
    geom_col(position = \"stack\") +
    geom_segment(aes(x = date,
                     y = 101,
                   yend = 110,
                     color = virus.bin),
                 linewidth = 6) +
    scale_color_manual(values = vircols) +
    scale_fill_manual(values = gencols) +
    facet_grid(rows = vars(sampleloc)) +
    theme())

dev.off()
}

allDf %>%
  dplyr::select(index,patientid) %>%
  filter(index %in% sinspu) %>%
  distinct() %>%
  .$patientid -> sinspuPtID

for(x in sinspuPtID){
  plot_taxa(allDf,x)
}

allDf %>%
  filter(patientid == \"GESCF02\") %>%
  mutate(genus = if_else(genus %in% c(\"Achromobacter\",\"Corynebacterium\",\"Pseudomonas\",\"Rothia\",\"Staphylococcus\",\"Streptococcus\"),
                         paste(\"*\",genus,\"*\",sep = \"\"),
                         \"Other\")) %>%
ggplot(aes(x = date,
               y = rel_ab,
               fill = genus)) +
    geom_col(position = \"stack\") +
    geom_segment(aes(x = date,
                     y = 101,
                   yend = 110,
                     color = virus.bin),
                 linewidth = 6) +
    scale_color_manual(values = vircols) +
    scale_fill_manual(values = gencols) +
    facet_grid(rows = vars(sampleloc)) +
    theme()
```

<!-- rnb-source-end -->
<!-- KNITR_ASIS_OUTPUT_TOKEN -->"
"0","```r
plot_taxa <- function(df,ptid){
  pdf(paste(
    paste(
      \"adult_pre_post_plots\",ptid,
      sep = \"/\"),
    \".pdf\",
    sep = \"\"),
  paper = \"a4\")
  
print(df %>%
    filter(index %in% sinspu) %>%
    filter(patientid == ptid) %>%
    mutate(genus = if_else(genus %in% c(\"Achromobacter\",\"Corynebacterium\",\"Pseudomonas\",\"Rothia\",\"Staphylococcus\",\"Streptococcus\"),
                         paste(\"*\",genus,\"*\",sep = \"\"),
                         \"Other\")) %>%
    ggplot(aes(x = date,
               y = rel_ab,
               fill = genus)) +
    geom_col(position = \"stack\") +
    geom_segment(aes(x = date,
                     y = 101,
                   yend = 110,
                     color = virus.bin),
                 linewidth = 6) +
    scale_color_manual(values = vircols) +
    scale_fill_manual(values = gencols) +
    facet_grid(rows = vars(sampleloc)) +
    theme())

dev.off()
}

allDf %>%
  dplyr::select(index,patientid) %>%
  filter(index %in% sinspu) %>%
  distinct() %>%
  .$patientid -> sinspuPtID

for(x in sinspuPtID){
  plot_taxa(allDf,x)
}

allDf %>%
  filter(patientid == \"GESCF02\") %>%
  mutate(genus = if_else(genus %in% c(\"Achromobacter\",\"Corynebacterium\",\"Pseudomonas\",\"Rothia\",\"Staphylococcus\",\"Streptococcus\"),
                         paste(\"*\",genus,\"*\",sep = \"\"),
                         \"Other\")) %>%
ggplot(aes(x = date,
               y = rel_ab,
               fill = genus)) +
    geom_col(position = \"stack\") +
    geom_segment(aes(x = date,
                     y = 101,
                   yend = 110,
                     color = virus.bin),
                 linewidth = 6) +
    scale_color_manual(values = vircols) +
    scale_fill_manual(values = gencols) +
    facet_grid(rows = vars(sampleloc)) +
    theme()
```"
